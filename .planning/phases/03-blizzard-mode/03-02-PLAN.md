---
phase: 03-blizzard-mode
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - client/src/components/canvas/nodes/SnowballNode.tsx
  - client/src/components/ui/ThermometerHUD.tsx
  - client/src/components/ui/QuizCard.tsx
  - client/src/components/ui/FrostOverlay.tsx
  - client/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Deep nodes with quiz data show 'Brave the Storm' button that triggers Blizzard Mode"
    - "Thermometer HUD displays warmth level (0-100) as a vertical bar during Blizzard Mode"
    - "Quiz card appears during Blizzard Mode with 4 answer options"
    - "Correct answer produces warm orange/gold flash and thermometer rises"
    - "Wrong answer produces icy blue flash and frost overlay creeps from screen edges"
    - "After answering, user can exit Blizzard Mode and return to Peace exploration"
  artifacts:
    - path: "client/src/components/ui/ThermometerHUD.tsx"
      provides: "Vertical thermometer bar showing warmth 0-100"
    - path: "client/src/components/ui/QuizCard.tsx"
      provides: "Quiz question with 4 clickable answer options"
    - path: "client/src/components/ui/FrostOverlay.tsx"
      provides: "Frost crystal overlay that creeps from screen edges on wrong answers"
  key_links:
    - from: "client/src/components/canvas/nodes/SnowballNode.tsx"
      to: "client/src/state/canvasStore.ts"
      via: "enterBlizzard action called on Brave the Storm click"
      pattern: "enterBlizzard"
    - from: "client/src/components/ui/QuizCard.tsx"
      to: "client/src/state/canvasStore.ts"
      via: "answerQuiz action called on option click"
      pattern: "answerQuiz"
    - from: "client/src/components/ui/ThermometerHUD.tsx"
      to: "client/src/state/canvasStore.ts"
      via: "warmth state drives thermometer fill height"
      pattern: "warmth"
---

<objective>
Build the complete Blizzard Mode gameplay UI: "Brave the Storm" trigger on quiz nodes, quiz card overlay, thermometer HUD, and warm/cold answer feedback with frost overlay.

Purpose: This is the gamification loop — the feature that makes FRACTAL a game, not just a knowledge map. The quiz experience must feel intense and atmospheric, with every correct/wrong answer producing visceral visual feedback.

Output: Clickable quiz trigger on nodes, full-screen quiz card, thermometer showing warmth, orange flash on correct, icy frost creep on wrong, and exit flow back to Peace mode.
</objective>

<execution_context>
@/Users/sahilpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sahilpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-blizzard-mode/03-01-SUMMARY.md
@client/src/state/canvasStore.ts
@client/src/components/canvas/nodes/SnowballNode.tsx
@client/src/config/api.ts
@client/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "Brave the Storm" trigger to SnowballNode and create quiz/feedback UI components</name>
  <files>
    client/src/components/canvas/nodes/SnowballNode.tsx
    client/src/components/ui/QuizCard.tsx
    client/src/components/ui/FrostOverlay.tsx
  </files>
  <action>
    **SnowballNode.tsx** — Add "Brave the Storm" button for nodes with quiz data:
    - Import `enterBlizzard` from canvasStore
    - Read `gameMode` from store to hide trigger during active blizzard
    - For nodes where `data.quiz` is not null AND `gameMode === 'peace'`:
      - Show a small button below the node label: "Brave the Storm" with a snowflake icon
      - Style: bg-blue-600/80 hover:bg-blue-500 text-white text-[10px] font-body px-2 py-0.5 rounded-full mt-1 transition-all
      - On click (stopPropagation to prevent expandNode): call `enterBlizzard(id, data.label, data.quiz)`
    - During blizzard mode (gameMode === 'blizzard'), the node that triggered it should have a subtle glowing border (ring-2 ring-blue-400/60 animate-pulse)

    **QuizCard.tsx** — Create centered quiz overlay component:
    - Reads `blizzardQuiz`, `quizResult`, `blizzardComplete`, `warmth` from canvasStore
    - Reads `answerQuiz`, `exitBlizzard` actions
    - Only renders when `blizzardQuiz` is not null
    - Layout: Fixed centered card at z-index `var(--z-hud)`, max-w-lg, with frosted glass styling:
      - bg-slate-900/90 backdrop-blur-md border border-slate-600/50 rounded-2xl p-8 shadow-2xl
    - Content:
      - Topic name at top: text-frost/60 text-sm font-body
      - Question: text-frost text-lg font-heading font-bold mb-6
      - 4 answer buttons in a 2x2 grid (grid grid-cols-2 gap-3):
        - Default: bg-slate-700/60 hover:bg-slate-600/80 text-frost font-body text-sm px-4 py-3 rounded-xl border border-slate-500/30 transition-all
        - After answering (blizzardComplete=true): Correct option gets bg-green-600/80 border-green-400, wrong selected gets bg-red-600/80 border-red-400, other options get opacity-50
        - Disable all buttons after answering
      - On click: call `answerQuiz(selectedIndex)`, store selectedIndex in local state to show which was picked
    - After answering (blizzardComplete=true), show "Return to Warmth" button below the grid:
      - bg-accent-warm hover:bg-accent-heat text-slate-900 font-heading font-bold px-6 py-2 rounded-full mt-6 transition-all
      - On click: call `exitBlizzard()`
    - Answer flash overlay: When `quizResult` is 'correct', briefly show a full-screen warm orange glow (fixed inset-0, bg-amber-500/20, pointer-events-none, z-index overlay). When 'wrong', show icy blue glow (bg-blue-400/20). Use framer-motion `AnimatePresence` + `motion.div` with opacity animate from 0.6 to 0, duration 0.8s.

    **FrostOverlay.tsx** — Create frost crystal edge overlay:
    - Reads `warmth` and `gameMode` from canvasStore
    - Only visible when gameMode is 'blizzard'
    - Uses a fixed full-screen div at z-index overlay (30), pointer-events-none
    - Frost intensity scales inversely with warmth: at warmth=50 (start) shows subtle frost, at warmth=0 shows heavy frost
    - Implementation: Use CSS box-shadow inset from all edges with ice-blue color
      - `box-shadow: inset 0 0 ${spreadPx}px ${blurPx}px rgba(147, 197, 253, opacity)` where spread/blur/opacity scale with (100 - warmth)
      - At warmth 50: spread=40, blur=20, opacity=0.15
      - At warmth 20: spread=100, blur=60, opacity=0.4
      - At warmth 0: spread=180, blur=100, opacity=0.6
    - Add `transition: box-shadow 0.8s ease-in-out` for smooth frost creep
    - Optional: Add 4 corner SVG frost crystal decorations (simple triangular frost patterns) that grow as warmth decreases, using CSS scale transforms
  </action>
  <verify>Run `cd client && npx tsc --noEmit` — no type errors.</verify>
  <done>SnowballNode shows "Brave the Storm" on quiz nodes. QuizCard renders centered quiz with 4 options and answer feedback. FrostOverlay shows frost edges based on warmth level. All components type-check.</done>
</task>

<task type="auto">
  <name>Task 2: Create ThermometerHUD and wire all Blizzard UI into App</name>
  <files>
    client/src/components/ui/ThermometerHUD.tsx
    client/src/App.tsx
  </files>
  <action>
    **ThermometerHUD.tsx** — Vertical thermometer component:
    - Reads `warmth`, `gameMode`, `quizResult` from canvasStore
    - Only visible when gameMode is 'blizzard'
    - Position: fixed right-8 top-1/2 -translate-y-1/2 at z-index hud (40)
    - Visual design — vertical bar thermometer:
      - Outer container: w-8 h-48 bg-slate-800/80 backdrop-blur-sm rounded-full border border-slate-600/50 overflow-hidden flex flex-col-reverse
      - Inner fill: Rounded bottom, height = `${warmth}%` of container
      - Fill color gradient: warmth > 60 = amber-500 (warm), 30-60 = yellow-500, < 30 = blue-400 (cold). Use CSS transition on height AND background-color, 0.8s ease-in-out
      - Add a subtle glow effect around the fill using box-shadow
    - Label below thermometer: text-frost/60 text-xs font-body text-center mt-2, shows "Warmth" text
    - On quizResult 'correct': briefly scale thermometer slightly (scale-110) for 300ms using CSS transition
    - On quizResult 'wrong': briefly shake using a CSS keyframe (translateX +-2px for 300ms)
    - Tick marks: 5 horizontal lines at 0%, 25%, 50%, 75%, 100% positions, thin white/20 lines

    **App.tsx** — Wire all new Blizzard UI components:
    - Import ThermometerHUD, QuizCard, FrostOverlay
    - Import `useCanvasStore` (if not already) and read `gameMode`
    - Add components in this order within the App div:
      1. ParallaxBackground (existing)
      2. SnowParticles (from Plan 01)
      3. InfiniteCanvas (existing)
      4. FrostOverlay (new — z-index overlay, pointer-events-none)
      5. QuizCard (new — z-index hud, centered, during blizzard only)
      6. ThermometerHUD (new — z-index hud, right side, during blizzard only)
      7. HUD overlay with title (existing)
      8. DemoToggle (existing)
    - The vignette overlay div from Plan 01 should already be present; FrostOverlay sits at the same z-level

    The full blizzard flow: User clicks "Brave the Storm" on a quiz node -> enterBlizzard fires -> gameMode='blizzard' -> sky darkens, snow intensifies, cabin fades, frost appears, thermometer shows, quiz card appears -> user answers -> warm/cold flash + thermometer changes + frost adjusts -> "Return to Warmth" button -> exitBlizzard -> everything returns to Peace mode.
  </action>
  <verify>Run `cd client && npx tsc --noEmit` — no type errors. Run `cd client && npm run build` — builds successfully. Open browser, expand a node with quiz data (e.g., "Galaxies" in demo mode), click "Brave the Storm", verify the complete blizzard flow works end-to-end.</verify>
  <done>ThermometerHUD shows warmth as vertical bar with color transitions. App.tsx wires all blizzard components. Full flow works: trigger -> atmosphere shift -> quiz -> answer feedback -> exit. Build passes.</done>
</task>

</tasks>

<verification>
1. `cd client && npx tsc --noEmit` passes with no errors
2. `cd client && npm run build` succeeds
3. In demo mode, expand "The Universe" -> click "Galaxies" -> see quiz snowflake icon
4. Click "Brave the Storm" on Galaxies node -> enters Blizzard Mode
5. Sky darkens, snow intensifies, cabin fades, frost overlay appears, thermometer appears at right
6. Quiz card shows with 4 options
7. Click correct answer -> warm orange flash, thermometer rises, correct option highlighted green
8. Click wrong answer -> icy blue flash, thermometer drops, frost creeps inward, option highlighted red
9. "Return to Warmth" button appears -> click -> everything returns to Peace mode smoothly
</verification>

<success_criteria>
- "Brave the Storm" button visible on nodes with quiz data
- Complete blizzard gameplay loop works end-to-end
- Thermometer HUD displays warmth with color-coded fill
- Correct answers produce warm flash + thermometer rise
- Wrong answers produce icy flash + frost overlay intensifies
- Smooth exit back to Peace mode
- No TypeScript errors, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03-blizzard-mode/03-02-SUMMARY.md`
</output>
